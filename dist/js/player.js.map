{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./js/player.ts"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","TICK","tasks","_tasks","_bid","now","performance","Function","Date","_dispatch","time","_af","length","task","this","_next","requestAnimationFrame","request","callback","push","finally","cancel","id","result","ot","et","dt","speed","isRun","options","option","render","config","step","pause","onEnd","play","ft","tt","_now","onPlay","increment","_play","mask","_continue","Player"],"mappings":"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","file":"js/player.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","\r\nconst USE_TIMEOUT = false;\r\nconst MAX_SAFE_TIME = 8640000000000;\r\n\r\ninterface TickCallbackFunction {\r\n    (time: number): void\r\n}\r\nclass Tick {\r\n    private tasks: Array<TickCallbackFunction> = [];\r\n    private _tasks: Array<TickCallbackFunction> = [];\r\n    private _bid = 0;\r\n    private _af: number;\r\n    private _next: Function;\r\n    constructor() {\r\n        this._next = USE_TIMEOUT ? window.setTimeout.bind(window, this._dispatch, 15) :\r\n            window.requestAnimationFrame.bind(window, this._dispatch)\r\n    }\r\n    request(callback: TickCallbackFunction) {\r\n        this._af || (this._af = this._next());\r\n        return this._bid + this.tasks.push(callback);\r\n    }\r\n    finally() {\r\n\r\n    }\r\n    cancel(id: number): TickCallbackFunction {\r\n        let result: TickCallbackFunction;\r\n        id -= this._bid + 1;\r\n        if (id >= 0) {\r\n            if (id < this.tasks.length) {\r\n                result = this.tasks[id];\r\n                this.tasks[id] = null;\r\n            }\r\n        } else if (this._tasks && (id += this._tasks.length) >= 0) {\r\n            result = this._tasks[id];\r\n            this._tasks[id] = null;\r\n        }\r\n        return result;\r\n    }\r\n    now: () => number = USE_TIMEOUT ? function () { return Date.now() } : (window.performance ?\r\n        function () { return performance.now() | 0; } :\r\n        (new Function(\"return Date.now()-\" + Date.now() + \";\")) as () => number)\r\n    private _dispatch = (time?: number) => {\r\n        time = time ? (time | 0) : this.now();\r\n        this._af = null;\r\n        this._bid += this.tasks.length;\r\n        this._tasks = this.tasks;\r\n        this.tasks = [];\r\n        for (let task of this._tasks) {\r\n            task && task(time);\r\n        }\r\n    }\r\n}\r\n\r\nconst TICK = new Tick();\r\n\r\ninterface RenderFunction {\r\n    (time: number): number\r\n}\r\ninterface PlayerConfig {\r\n    onPlay?: (ft: number, tt: number) => boolean | void,\r\n    onEnd?: (dtime?: number) => void,\r\n    [key: string]: any\r\n}\r\nclass Player {\r\n    private ot = 0;\r\n    private et = 0;\r\n    private dt = 0;\r\n    private _af: number;\r\n    static TICK = TICK;\r\n    speed = 1;\r\n    isRun = false;\r\n    config: PlayerConfig;\r\n    render: RenderFunction;\r\n    constructor(...options: Array<RenderFunction | PlayerConfig | number>) {\r\n        for (const option of options) {\r\n            switch (typeof option) {\r\n                case \"function\":\r\n                    this.render = option;\r\n                    break;\r\n                case \"object\":\r\n                    this.config = option;\r\n                    break;\r\n                case \"number\":\r\n                    this.speed = option;\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    step(step: number) {\r\n        this.render(this.dt = step);\r\n        return this;\r\n    }\r\n    pause() {\r\n        if (this.isRun) {\r\n            this.isRun = false;\r\n            TICK.cancel(this._af);\r\n            this.config?.onEnd?.();\r\n        }\r\n        return this;\r\n    }\r\n    /*stop() {\r\n        this.pause();\r\n        this.dt = 0;\r\n        return this;\r\n    }*/\r\n    play(ft: number = this.dt, tt: number = MAX_SAFE_TIME) {\r\n        let _now = TICK.now();\r\n        if (!this.config?.onPlay?.(ft, tt)) {\r\n            let increment = tt >= ft ? this.speed : -this.speed;\r\n            this.ot = _now - ft / increment;\r\n            this.et = this.ot + tt / increment;\r\n            TICK.cancel(this._af);\r\n            this._play(_now, increment, tt >= ft ? 0b100 : 0b001);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    private _play(time: number, increment: number, mask: number) {\r\n        this.isRun = true;\r\n        let _continue = (time: number) => {\r\n            this.dt = (time - this.ot) * increment;\r\n            if (time <= this.et && !(this.render(this.dt) & mask)) {\r\n                this._af = TICK.request(_continue);\r\n            } else {\r\n                this.dt = (this.et - this.ot) * increment;\r\n                time < this.et || this.render(this.dt);\r\n                this.isRun = false;\r\n                this.config?.onEnd?.(time - this.et);\r\n            }\r\n        }\r\n        _continue(time);\r\n    }\r\n}\r\nexport default Player;"],"sourceRoot":""}